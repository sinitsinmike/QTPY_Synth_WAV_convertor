# QTPY Synth + WAV Converter

Небольшой DIY-синт на **Adafruit QT Py RP2040** (CircuitPython) + веб-конвертер WAV → **wavetable**, совместимый с проектом.

---

## Быстрый старт (Synth)

### Как играть
- **Touch pads** — играют ноты (каждый пэд = своя нота).
- Отпустил пэд — нота выключается.
- LED/индикатор реагирует на активные ноты.

### Одна кнопка (KEY)
- **Короткое нажатие**: переключает режим ручек (**Mode 0 → 1 → 2 → 3 → 0**).
- **Удержание + touch pad**: задумывалось как “загрузка патча”, но сейчас **отключено** в коде (не используется).

---

## Управление ручками (4 режима)

### Mode 0 — выбор тембра + Wave Mix
**Knob A (левая):** выбор источника/пресета из списка `wave_selects`  
Примеры: `osc:SAW/SIN`, `osc:SAW/SQU`, `wtb:A1`

**Knob B (правая):** `wave_mix` (0…1)

Как работает `wave_mix`:
- **Если выбран `osc:X/Y`** — плавный кроссфейд форм:
  - `0.0` → чистый `X`
  - `1.0` → чистый `Y`
  - между ними → плавная смесь (lerp)
- **Если выбран `wtb:NAME`** — сканирование wavetable внутри WAV (позиция `wave_pos` по таблице волн)

---

### Mode 1 — Detune + LFO depth (для WTB)
**Knob A:** `detune` (примерно 1…1.1)  
Множитель частоты для **второго осциллятора** (делает звук “шире/толще”).

**Knob B:** `wave_mix_lfo_amount` (0…1)  
Глубина LFO, которая добавляется к wavetable-scan.

Важно:
- LFO влияет **в основном в режиме WTB**, где используется логика вида:  
  `wave_pos = wave_mix * num_waves + LFO * amount * 10`
- В режиме `osc:X/Y` LFO для `wave_mix` сейчас почти не задействован (по коду помечено как не доделано).

---

### Mode 2 — Фильтр: тип + частота
**Knob A:** `filt_type` (0..3) — 4 типа фильтра  
**Knob B:** `filt_f` (~100…8000 Hz) — частота среза

---

### Mode 3 — Фильтр: резонанс + атака envelope
**Knob A:** `filt_q` (~0.5…2.5) — резонанс  
**Knob B:** `filt_env_params.attack_time` (~1…0.01) — атака envelope фильтра

---

## Как устроен звук (важная логика)

### Два осциллятора на голос
Каждая нота создаёт voice с двумя осцилляторами:
- **osc1** — основной
- **osc2** — второй, обычно тот же источник, но с **detune** (Mode 1)

### Что делает правая ручка в `osc:SAW/TRI`
Это **НЕ wav-файл**.  
Правая ручка (`wave_mix`) делает плавный микс **двух форм** (SAW↔TRI). Получившаяся форма применяется к обоим осцилляторам, а detune “раздвигает” osc2 по частоте.

### Что делает правая ручка в `wtb:...`
Это **сканирование wavetable**:
- WAV содержит много циклов (волн) одинаковой длины (обычно 256 сэмплов на волну).
- `wave_mix` двигает позицию по таблице.
- Между соседними волнами делается кроссфейд → плавный морфинг тембра.

---

## Фичи (по факту кода)
- Полифония
- 2 осциллятора на голос + detune
- Источник:
  - **OSC**: кроссфейд между двумя формами
  - **WTB**: wavetable из WAV + сканирование
- LFO depth для wavetable-scan (WTB)
- Фильтр: тип / частота / Q + envelope (attack)
- 4 режима ручек, переключение одной кнопкой
- MIDI обработчик (в коде есть обработка/привязки CC)

---

## WAV Converter (Web)

В репозитории есть веб-страница, которая делает “правильный” WAV для wavetable:
- Drag & drop одного или нескольких файлов
- Приведение к:
  - mono
  - 16-bit PCM
  - 44.1 kHz
- Обрезка/дополнение до **N × 256** сэмплов (Auto=64 по умолчанию)
- Опционально: fade-in / fade-out + настройка fade length
- Download отдельных файлов + ZIP для нескольких

---

## Troubleshooting

### “Convert” не нажимается
- Сначала выбери WAV (кнопка активируется после выбора).
- Нажми **Self-check deps**: в Log покажет, каких файлов не хватает / какие 404.

### ffmpeg не грузится
- Нажми **Load ffmpeg only** и смотри Log.
- Проверь, что в `/deps` лежат все нужные файлы (Self-check должен быть весь ✅).
- Сделай hard refresh страницы: **Ctrl+F5 / Cmd+Shift+R**.

---

## Контакты / ссылки
- Email: sinitsinmike@yahoo.com
- Project page: https://github.com/sinitsinmike/QTPY_Synth_WAV_convertor/tree/main
- VK: https://vk.com/club233031179
- Telegram: https://t.me/SamodelnieSintezotory
- YouTube: https://www.youtube.com/@Electronic_hobby
- RuTube: https://rutube.ru/channel/23533497/
